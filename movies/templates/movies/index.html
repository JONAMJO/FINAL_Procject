{% extends 'movies/base.html' %}
{% load bootstrap4 %}
{% load static %}

{% block css %}
  body {
    background: url('{% static 'movies/bg_image.jpg' %}');
    background-size: 100% 100%;
    background-attachment: fixed;
  }
{% endblock css %}
{% block content %}

<br>

<div class="container" style="padding-left:60px">
  <div id="jonamjo" class="carousel slide m-2" data-ride="carousel" style="width: 30%; display:inline-block;">
    <div class="carousel-inner">
      {% for movie in movies %}
      {% if movie.pk <= 20 %}
      {% if movie.pk == 1 %}
      <div class="carousel-item active">
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Nulla vitae elit libero, a pharetra augue mollis interdum.</p>
        </div>
      </div>
      {% else %}
      <div class="carousel-item">
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </div>
      </div>
      {% endif %}
      {% endif %}
      {% endfor %}

    <h3 style="font-family: 'Jua', sans-serif;">추천 영화</h3>
{% for movie in movie.user_rating.all %}
  {% if movie.user_rating >= 8 %}
    {{ movie.poster_url }}
  {% endif %}
{% endfor %}

<div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{{ movies.image }}" class="d-block w-10" alt="...">

    </div>
    <a class="carousel-control-prev" href="#jonamjo" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#jonamjo" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

  <div id="jonamjo2" class="carousel slide m-2" data-ride="carousel"
    style="width: 30%; display:inline-block; margin:0 auto">
    <div class="carousel-inner">
      {% for movie in movies %}
      {% if movie.pk == 21 %}
      <div class="carousel-item active">
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Nulla vitae elit libero, a pharetra augue mollis interdum.</p>
        </div>
      </div>
      {% else %}
      <div class="carousel-item">

        
        
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </div>

        <img src="{{ movie.poster_url }}" class="d-block" alt="..." style="width:1000px; height:200px;">

      
      
      </div>
      {% endif %}
      {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#jonamjo2" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#jonamjo2" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

  <div id="jonamjo3" class="carousel slide m-2" data-ride="carousel"
    style="width: 30%; display:inline-block; margin:0 auto">
    <div class="carousel-inner">
      {% for movie in movies %}
      {% if movie.pk == 40 %}
      <div class="carousel-item active">
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Nulla vitae elit libero, a pharetra augue mollis interdum.</p>
        </div>
      </div>
      {% else %}
      <div class="carousel-item">
        <img src="{{ movie.image }}" class="d-block w-100" alt="img">
        <div class="carousel-caption d-none d-md-block">
          <h5>{{ movie.title }}</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
    <div>
      <a class="carousel-control-prev" href="#jonamjo3" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#jonamjo3" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>

  <br>

  <select v-model="selectedGenreId" class="form-control">
    <option v-for="genre in genres" :key="genre.id" :value="genre.id">{{ genre.name }}</option>
  </select>
  <div class="row mt-5" v-if="selectedGenreId === 0">
    <movie-list-item v-for="movie in movies" :key="movie.id" :movie="movie"></movie-list-item>
  </div>
  <div class="row mt-5" v-else>
    <movie-list-item v-for="movie in filterMovies" :key="movie.id" :movie="movie"></movie-list-item>
  </div>
</div>



<div class="container">
  <div class="row justify-content-center">
    {% for movie in movies %}

    <div class="card text-center col-3 my-1" style="width: 25rem;">
      <div class="card-body px-0 ">

        
        
        <a href="{{ movie.get_absolute_url }}">
          <figure class="snip1200">
            <img src="{{ movie.image }}" alt="img" style="width:210px">
            <figcaption>
              <p>{{ movie.subtitle }} </p>
              <div class="heading">
              <h4>{{ movie.title }}</h4>
              </div>
              <br>
            </figcaption>
          </figure>
        </a>

        <a href="{{ movie.get_absolute_url }}"><img src="{{ movie.poster_url }}" alt="img" style="width:210px"></a>
        <h6 class="card-title"><span class="badge badge-pill badge-info">{{ movie.title }}</span></h6>

      
      {% if user in movie.like_users.all %}
        <i class="fas fa-heart like-button" style="color: crimson;" data-id="{{ movie.pk }}">
          <span id="like-count-{{ movie.pk }}">{{ movie.like_users.count }}</span> 좋아요
        </i>
        {% else %}
        <i class="fas fa-heart like-button" style="color: black;" data-id="{{ movie.pk }}">
          <span id="like-count-{{ movie.pk }}">{{ movie.like_users.count }}</span> 좋아요
        </i>
        {% endif %}
        <br>
      </div>
    </div>
    {% endfor %}
  </div>
</div>


<style>
  @import url(https://fonts.googleapis.com/css?family=Raleway:400,500,800);

  figure.snip1200 {
    font-family: 'Raleway', Arial, sans-serif;
    position: relative;
    overflow: hidden;
    margin: 10px;
    min-width: 230px;
    max-width: 230px;
    min-height: 300px;
    max-height: 300px;
    width: 100%;
    background: #000000;
    color: #ffffff;
    text-align: center;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
    font-size: 16px;
  }

  figure.snip1200 * {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-transition: all 0.45s ease-in-out;
    transition: all 0.45s ease-in-out;
  }

  figure.snip1200 img {
    max-width: 100%;
    position: relative;
    opacity: 0.9;
  }

  figure.snip1200 figcaption {
    position: absolute;
    top: 45%;
    left: 7%;
    right: 7%;
    bottom: 45%;
    border: 1px solid white;
    border-width: 1px 1px 0;
  }

  figure.snip1200 .heading {
    overflow: hidden;
    -webkit-transform: translateY(50%);
    transform: translateY(50%);
    position: absolute;
    bottom: 0;
    width: 100%;
  }

  figure.snip1200 h4 {
    display: table;
    margin: 0 auto;
    padding: 0 10px;
    position: relative;
    text-align: center;
    width: auto;
    text-transform: uppercase;
    font-weight: 400;
  }

  figure.snip1200 h4 span {
    font-weight: 800;
  }

  figure.snip1200 h4:before,
  figure.snip1200 h4:after {
    position: absolute;
    display: block;
    width: 1000%;
    height: 1px;
    content: '';
    background: white;
    top: 50%;
  }

  figure.snip1200 h4:before {
    left: -1000%;
  }

  figure.snip1200 h4:after {
    right: -1000%;
  }

  figure.snip1200 p {
    top: 50%;
    -webkit-transform: translateY(-50%);
    transform: translateY(-50%);
    position: absolute;
    width: 100%;
    padding: 0 20px;
    margin: 0;
    opacity: 0;
    line-height: 1.6em;
    font-size: 0.9em;
  }

  figure.snip1200 a {
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    position: absolute;
    z-index: 1;
  }

  figure.snip1200:hover img,
  figure.snip1200.hover img {
    opacity: 0.25;
    -webkit-transform: scale(1.1);
    transform: scale(1.1);
  }

  figure.snip1200:hover figcaption,
  figure.snip1200.hover figcaption {
    top: 7%;
    bottom: 7%;
  }

  figure.snip1200:hover p,
  figure.snip1200.hover p {
    opacity: 1;
    -webkit-transition-delay: 0.35s;
    transition-delay: 0.35s;
  }
</style>




<script>
  const likebuttons = document.querySelectorAll('.like-button')
  likebuttons.forEach(button => {
      button.addEventListener('click', function (event) {
        const movieId = event.target.dataset.id
        axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest'
        axios.defaults.xsrfCookieName = 'csrftoken'
        axios.defaults.xsrfHeaderName = 'X-CSRFToken'
        axios.post(`/movies/${movieId}/like/`)
          .then(response => {
            document.querySelector(`#like-count-${movieId}`).innerText = response.data.count
            if (response.data.liked) {
              event.target.style.color = 'crimson'
            } else {
              event.target.style.color = 'black'
            }
          })
      })
    }),
    $(".hover").mouseleave(
      function () {
        $(this).removeClass("hover");
      }
    );
</script>

{% endblock %}